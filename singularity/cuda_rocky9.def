Bootstrap: docker
From: nvidia/cuda:12.2.0-devel-rockylinux9

%labels
    Maintainer Pu Jiao
    Description "Rocky 9 with CUDA 12.2 and development essentials"

%post
    echo "Updating system and installing developer tools..."

    # Update and install dev tools
    dnf -y update
    dnf -y groupinstall "Development Tools"
    dnf -y install \
        gcc \
        gcc-c++ \
        make \
        wget \
        which \
        vim \
        git \
        python3 \
        python3-pip \
        epel-release

    # Clean up to reduce size
    dnf clean all

    echo "Verifying CUDA installation..."
    nvcc --version

%environment
    export PATH=/usr/local/cuda/bin:$PATH
    export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
    export PS1="[apptainer-rocky9] \u@\h:\w\$ "

%runscript
    echo "Welcome to Rocky 9 developer container with CUDA 12.2"
    exec /bin/bash "$@"
